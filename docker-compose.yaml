version: '3.0'

services:
  voice-gpt-app:
    image: voice-gpt-app
    container_name: voice-gpt-app
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
    devices:
        - /dev/snd:/dev/snd
    environment:
      - "GPT_HOME="

      # OPENAI API CONFIG
      - "OPENAI_API_KEY=${OPENAI_API_KEY}"
      - "MODEL_NAME=text-davinci-003"

      # HOSTS OF SERVICES
      - "GPT_HOST=localhost:8080"
      - "LISTENER_HOST=localhost:8081"
      - "GUI_HOST=localhost:8082"
      - "TTS_HOST=localhost:5001"
      - "STT_HOST=localhost:5000"

      #POSTGRES CONFIG
      - 'POSTGRES_USER=${POSTGRES_USER:-postgres}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-password}'
      - "POSTGRES_HOST=jdbc:postgresql://postgres:5432/logs-db"

      # ENABLING GUI
      - "DISPLAY=${DISPLAY}"
    ports:
      - "8081:8081"
    depends_on:
      - postgres
    networks:
      - backend
    tty: true

  postgres:
    image: postgres
    volumes:
      - logs-data:/var/lib/postgresql/data
    container_name: postgres
    ports:
      - '2345:5432'
    environment:
      - 'POSTGRES_USER=${POSTGRES_USER:-postgres}'
      - 'POSTGRES_PASSWORD=#{POSTGRES_PASSWORD:-password}'
      - 'POSTGRES_DB=logs-db'
    networks:
      - backend

volumes:
  logs-data:

networks:
  backend:
